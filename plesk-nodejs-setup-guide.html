<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plesk Node.js Setup Guide - Virginia Hodges Real Estate</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        .header h1 {
            margin: 0;
            font-size: 2.5em;
            font-weight: 300;
        }
        .header p {
            margin: 10px 0 0;
            opacity: 0.9;
            font-size: 1.1em;
        }
        .content {
            padding: 30px;
        }
        .section {
            margin-bottom: 40px;
            padding: 25px;
            border-radius: 10px;
            border-left: 5px solid #3498db;
            background: #f8f9fa;
        }
        .section h2 {
            color: #2c3e50;
            margin-top: 0;
            font-size: 1.8em;
            display: flex;
            align-items: center;
        }
        .section h3 {
            color: #34495e;
            border-bottom: 2px solid #ecf0f1;
            padding-bottom: 10px;
            margin-top: 30px;
        }
        .config-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .config-table th, .config-table td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #ecf0f1;
        }
        .config-table th {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            font-weight: 600;
        }
        .config-table tr:hover {
            background-color: #f8f9fa;
        }
        .config-value {
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            background: #e8f4f8;
            padding: 4px 8px;
            border-radius: 4px;
            font-weight: 600;
            color: #2c3e50;
        }
        .command {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            margin: 15px 0;
            overflow-x: auto;
            position: relative;
        }
        .command:before {
            content: "$ ";
            color: #3498db;
            font-weight: bold;
        }
        .env-var {
            background: #27ae60;
            color: white;
            padding: 20px;
            border-radius: 8px;
            margin: 15px 0;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
        }
        .warning {
            background: #f39c12;
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }
        .success {
            background: #27ae60;
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }
        .note {
            background: #e74c3c;
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }
        .step-number {
            background: #3498db;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            margin-right: 10px;
            font-weight: bold;
        }
        .icon {
            margin-right: 10px;
            font-size: 1.2em;
        }
        ul {
            list-style: none;
            padding-left: 0;
        }
        li {
            padding: 8px 0;
            border-bottom: 1px solid #ecf0f1;
        }
        li:before {
            content: "‚úì ";
            color: #27ae60;
            font-weight: bold;
            margin-right: 10px;
        }
        .footer {
            background: #34495e;
            color: white;
            text-align: center;
            padding: 20px;
            margin-top: 40px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöÄ Plesk Node.js Setup Guide</h1>
            <p>Complete configuration instructions for Virginia Hodges Real Estate</p>
        </div>

        <div class="content">
            <!-- Node.js Configuration Section -->
            <div class="section">
                <h2><span class="icon">‚öôÔ∏è</span>Node.js Configuration Settings</h2>
                <p>Configure these exact settings in your Plesk Panel ‚Üí Domains ‚Üí askforvirginia.com ‚Üí Node.js</p>
                
                <table class="config-table">
                    <thead>
                        <tr>
                            <th>Setting</th>
                            <th>Value</th>
                            <th>Description</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>Node.js Version</strong></td>
                            <td><span class="config-value">18.19.0</span> or higher</td>
                            <td>Latest LTS version for best compatibility and performance</td>
                        </tr>
                        <tr>
                            <td><strong>Package Manager</strong></td>
                            <td><span class="config-value">npm</span></td>
                            <td>Default package manager (do not change to yarn)</td>
                        </tr>
                        <tr>
                            <td><strong>Document Root</strong></td>
                            <td><span class="config-value">/httpdocs</span></td>
                            <td>Plesk default document root (leave unchanged)</td>
                        </tr>
                        <tr>
                            <td><strong>Application Mode</strong></td>
                            <td><span class="config-value">production</span></td>
                            <td>Optimized for production performance</td>
                        </tr>
                        <tr>
                            <td><strong>Application URL</strong></td>
                            <td><span class="config-value">https://askforvirginia.com</span></td>
                            <td>Your production domain (will redirect HTTP to HTTPS)</td>
                        </tr>
                        <tr>
                            <td><strong>Application Root</strong></td>
                            <td><span class="config-value">/</span></td>
                            <td>Root directory of the Node.js application</td>
                        </tr>
                        <tr>
                            <td><strong>Application Startup File</strong></td>
                            <td><span class="config-value">ecosystem.config.js</span></td>
                            <td>PM2 ecosystem file for managing multiple processes</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Environment Variables Section -->
            <div class="section">
                <h2><span class="icon">üîß</span>Custom Environment Variables</h2>
                <p>Add these environment variables in the Plesk Node.js settings panel:</p>
                
                <div class="env-var">
<strong>Production Environment Variables:</strong><br><br>
NODE_ENV=production<br>
PORT=5001<br>
FRONTEND_URL=https://askforvirginia.com<br><br>

# Database Configuration<br>
DB_HOST=localhost<br>
DB_PORT=3306<br>
DB_NAME=virginia_prod<br>
DB_USER=virginia_prod<br>
DB_PASS=your_secure_database_password<br><br>

# Authentication<br>
JWT_SECRET=your_super_secure_jwt_secret_key_for_production<br>
JWT_EXPIRES_IN=7d<br><br>

# Email Configuration<br>
SMTP_HOST=mail.askforvirginia.com<br>
SMTP_PORT=587<br>
SMTP_USER=noreply@askforvirginia.com<br>
SMTP_PASS=your_email_password<br>
FROM_EMAIL=noreply@askforvirginia.com<br><br>

# Security<br>
BCRYPT_ROUNDS=12<br>
RATE_LIMIT_WINDOW=15<br>
RATE_LIMIT_MAX=100<br><br>

# File Upload<br>
MAX_FILE_SIZE=10485760<br>
UPLOAD_DIR=/var/www/vhosts/askforvirginia.com/askforvirginia.com/apps/web/public/uploads
                </div>
            </div>

            <!-- Node.js Commands Section -->
            <div class="section">
                <h2><span class="icon">üíª</span>Required Node.js Commands</h2>
                <p>Run these commands in the <strong>"Run Node.js Commands"</strong> section of Plesk in the following order:</p>

                <h3><span class="step-number">1</span>Install Dependencies</h3>
                <div class="command">npm install --production --no-audit --no-fund</div>
                <p><strong>Purpose:</strong> Install only production dependencies without development packages</p>

                <h3><span class="step-number">2</span>Install PM2 Globally</h3>
                <div class="command">npm install -g pm2</div>
                <p><strong>Purpose:</strong> Install PM2 process manager for handling multiple Node.js processes</p>

                <h3><span class="step-number">3</span>Build the Application</h3>
                <div class="command">npm run build</div>
                <p><strong>Purpose:</strong> Compile TypeScript and build both API and web applications</p>

                <div class="warning">
                    <strong>‚ö†Ô∏è Important:</strong> Wait for each command to complete before running the next one. The build process may take 2-3 minutes.
                </div>

                <h3><span class="step-number">4</span>Start with PM2</h3>
                <div class="command">pm2 start ecosystem.config.js --env production</div>
                <p><strong>Purpose:</strong> Start both API and web servers using PM2 configuration</p>

                <h3><span class="step-number">5</span>Save PM2 Configuration</h3>
                <div class="command">pm2 save</div>
                <p><strong>Purpose:</strong> Save current PM2 processes for auto-restart on server reboot</p>

                <h3><span class="step-number">6</span>Setup PM2 Startup</h3>
                <div class="command">pm2 startup</div>
                <p><strong>Purpose:</strong> Configure PM2 to start automatically when server boots</p>

                <div class="success">
                    <strong>‚úÖ Verification Commands:</strong><br>
                    After setup, verify everything is running:
                </div>

                <h3><span class="step-number">7</span>Check PM2 Status</h3>
                <div class="command">pm2 status</div>
                <p><strong>Expected Output:</strong> Should show both 'virginia-api' and 'virginia-web' as 'online'</p>

                <h3><span class="step-number">8</span>Check Application Logs</h3>
                <div class="command">pm2 logs --lines 50</div>
                <p><strong>Purpose:</strong> View recent logs to ensure no errors during startup</p>
            </div>

            <!-- Post-Deployment Verification -->
            <div class="section">
                <h2><span class="icon">‚úÖ</span>Post-Deployment Verification</h2>
                <p>After completing the Node.js setup, verify your application is working:</p>

                <h3>Health Check Endpoints</h3>
                <ul>
                    <li><strong>API Health:</strong> <span class="config-value">https://askforvirginia.com/api/health</span></li>
                    <li><strong>Website:</strong> <span class="config-value">https://askforvirginia.com</span></li>
                    <li><strong>Admin Panel:</strong> <span class="config-value">https://askforvirginia.com/admin</span></li>
                </ul>

                <h3>Expected Responses</h3>
                <div class="env-var">
API Health Check Response:<br>
{<br>
  "status": "healthy",<br>
  "timestamp": "2025-01-XX...",<br>
  "uptime": "XX minutes",<br>
  "database": "connected",<br>
  "environment": "production"<br>
}
                </div>
            </div>

            <!-- Troubleshooting Section -->
            <div class="section">
                <h2><span class="icon">üîç</span>Troubleshooting Common Issues</h2>

                <h3>Issue: Node.js Application Won't Start</h3>
                <div class="note">
                    <strong>Solution:</strong> Check the Plesk Node.js error logs at:<br>
                    <span class="config-value">/var/www/vhosts/system/askforvirginia.com/logs/nodejs_error.log</span>
                </div>

                <h3>Issue: PM2 Processes Not Running</h3>
                <div class="command">pm2 restart ecosystem.config.js --env production</div>

                <h3>Issue: Database Connection Failed</h3>
                <div class="note">
                    <strong>Solution:</strong> Verify database credentials and run:<br>
                    <span class="config-value">mysql -h localhost -u virginia_prod -p virginia_prod</span>
                </div>

                <h3>Issue: File Permissions</h3>
                <div class="command">sudo chown -R $(whoami):psacln /var/www/vhosts/askforvirginia.com/</div>
                <div class="command">sudo chmod -R 755 /var/www/vhosts/askforvirginia.com/askforvirginia.com</div>
            </div>

            <!-- Test Deployment Section -->
            <div class="section">
                <h2><span class="icon">üß™</span>Test Deployment First (Recommended)</h2>
                <p>Before deploying to production, it's highly recommended to test on <strong>dev.askforvirginia.com</strong> first:</p>
                
                <h3>Test Environment Setup</h3>
                <div class="warning">
                    <strong>‚ö†Ô∏è Test First:</strong> Always deploy to dev.askforvirginia.com before production to catch any issues.
                </div>
                
                <table class="config-table">
                    <thead>
                        <tr>
                            <th>Setting</th>
                            <th>Test Value (dev.askforvirginia.com)</th>
                            <th>Production Value (askforvirginia.com)</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>Domain</strong></td>
                            <td><span class="config-value">dev.askforvirginia.com</span></td>
                            <td><span class="config-value">askforvirginia.com</span></td>
                        </tr>
                        <tr>
                            <td><strong>Database Name</strong></td>
                            <td><span class="config-value">virginia_test</span></td>
                            <td><span class="config-value">virginia_prod</span></td>
                        </tr>
                        <tr>
                            <td><strong>Database User</strong></td>
                            <td><span class="config-value">virginia_test</span></td>
                            <td><span class="config-value">virginia_prod</span></td>
                        </tr>
                        <tr>
                            <td><strong>Database Password</strong></td>
                            <td><span class="config-value">D@taLore323</span></td>
                            <td><span class="config-value">your_secure_password</span></td>
                        </tr>
                        <tr>
                            <td><strong>PM2 Environment</strong></td>
                            <td><span class="config-value">--env test</span></td>
                            <td><span class="config-value">--env production</span></td>
                        </tr>
                    </tbody>
                </table>

                <h3>Test Deployment Process</h3>
                <div class="env-var">
<strong>Test Environment Variables for dev.askforvirginia.com:</strong><br><br>
NODE_ENV=production<br>
PORT=5001<br>
FRONTEND_URL=https://dev.askforvirginia.com<br><br>

# Database Configuration (Test)<br>
DB_HOST=localhost<br>
DB_PORT=3306<br>
DB_NAME=virginia_test<br>
DB_USER=virginia_test<br>
DB_PASS=D@taLore323<br><br>

# Authentication (Test Keys)<br>
JWT_SECRET=test-jwt-secret-change-for-production<br>
JWT_EXPIRES_IN=24h<br><br>

# Email Configuration<br>
SMTP_HOST=smtp.gmail.com<br>
SMTP_PORT=587<br>
SMTP_USER=your-test-email@gmail.com<br>
SMTP_PASS=your-app-password<br>
FROM_EMAIL=noreply@askforvirginia.com<br><br>

# Security (Test Settings)<br>
CORS_ORIGIN=https://dev.askforvirginia.com<br>
RATE_LIMIT_WINDOW=15<br>
RATE_LIMIT_MAX=100
                </div>

                <h3>Test Deployment Commands</h3>
                <p>For test deployment, use these modified commands:</p>
                
                <h4><span class="step-number">1</span>Create Test Database in Plesk</h4>
                <ul>
                    <li>Database Name: <span class="config-value">virginia_test</span></li>
                    <li>Database User: <span class="config-value">virginia_test</span></li>
                    <li>Password: <span class="config-value">D@taLore323</span></li>
                </ul>

                <h4><span class="step-number">2</span>Deploy to Test Environment</h4>
                <div class="command">npm install --production</div>
                <div class="command">npm install -g pm2</div>
                <div class="command">npm run build</div>
                <div class="command">pm2 start ecosystem.config.js --env test</div>
                <div class="command">pm2 save</div>

                <h4><span class="step-number">3</span>Test Verification</h4>
                <ul>
                    <li>Visit: <span class="config-value">https://dev.askforvirginia.com</span></li>
                    <li>API Test: <span class="config-value">https://dev.askforvirginia.com/api/health</span></li>
                    <li>Admin Panel: <span class="config-value">https://dev.askforvirginia.com/admin</span></li>
                </ul>

                <div class="success">
                    <strong>‚úÖ Test Success Criteria:</strong><br>
                    ‚Ä¢ Website loads without errors<br>
                    ‚Ä¢ API health check returns "healthy"<br>
                    ‚Ä¢ Database connection working<br>
                    ‚Ä¢ Contact forms functional<br>
                    ‚Ä¢ Admin panel accessible<br>
                </div>

                <div class="note">
                    <strong>üîÑ Migration to Production:</strong><br>
                    Only proceed to production deployment after successful testing on dev.askforvirginia.com. 
                    Update environment variables to use production values and change PM2 environment to <span class="config-value">--env production</span>.
                </div>
            </div>

            <!-- Final Steps -->
            <div class="section">
                <h2><span class="icon">üéØ</span>Final Steps</h2>
                <ol style="list-style: decimal; padding-left: 20px;">
                    <li style="border-bottom: none;">‚úÖ <strong>Complete test deployment</strong> on dev.askforvirginia.com first</li>
                    <li style="border-bottom: none;">Configure SSL certificate and force HTTPS redirect in Plesk</li>
                    <li style="border-bottom: none;">Add the Nginx directives from the deployment checklist</li>
                    <li style="border-bottom: none;">Set up database backups in Plesk</li>
                    <li style="border-bottom: none;">Configure email notifications for monitoring</li>
                    <li style="border-bottom: none;">Test all functionality including contact forms and admin panel</li>
                </ol>

                <div class="success">
                    <strong>üéâ Congratulations!</strong> Your Virginia Hodges Real Estate website is now live on production!
                </div>
            </div>
        </div>

        <div class="footer">
            <p>&copy; 2025 Virginia Hodges Real Estate - Production Deployment Guide</p>
            <p>For support, contact your development team or Plesk hosting provider</p>
        </div>
    </div>
</body>
</html>